{% extends "base.html" %}
{% block content %}
<section id="kkt">
    <h2>우리들의 카카오톡 기록...</h2>

    <h3>1. 우리는 얼마나 많은 대화를 했을까?</h3>
    
    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>1-1. 우리는 {{ data.start_year }}년부터 {{ data.end_year }}년까지
            총 {{ data.msg_total }}마디를 했습니다.^^</h4>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>1-2. 연도별 메시지 수</h4>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>연도</th>
                <th>메시지 수</th>
            </tr>
            {% for year in data.year_list %}
            <tr>
                <td>{{ year[0] }}년</td>
                <td>{{ year[1] }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>1-3. 월별 메시지 수</h4>
        <p>우리는 {{ data.month_most }}에 가장 많이 대화하고, {{ data.month_least}}에 가장 적게 대화합니다. </p>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>월</th>
                <th>메시지 수(많은 순)</th>
            </tr>
            {% for val in data.month_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ val[0] }}</td>
                <td>{{ val[1] }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>1-4. 가장 많은 대화를 나눈 날짜</h4>
        <p>우리는 {{ data.date_most }}에 가장 많이 대화합니다.</p>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>날짜</th>
                <th>메시지 수(많은 순)</th>
            </tr>
            {% for date in data.date_most_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ date[0] }}</td>
                <td>{{ date[1] }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>1-5. 가장 적은 대화를 나눈 날짜</h4>
        <p>우리는 {{ data.date_least }}에 가장 적게 대화합니다.</p>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>날짜</th>
                <th>메시지 수(적은 순)</th>
            </tr>
            {% for date in data.date_least_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ date[0] }}</td>
                <td>{{ date[1] }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>1-6. 시간별 대화량</h4>
        <p>
            우리는 카톡을 {{ data.time_most }}시에 가장 많이 보내고, {{ data.time_least }}시에 가장 적게 보냅니다..<br>
            이 야행성들.ㅋ
        </p>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>시간</th>
                <th>메시지 수(많은 순)</th>
            </tr>
            {% for time in data.time_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ time[0] }}시</td>
                <td>{{ time[1] }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    

    <h3>2. 우리는 무슨 말을 할까?</h3>
    
    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>2-1. 우리는 "{{ data.msg_most }}" 을 가장 많이 사용합니다. 무려 {{ data.msg_most_count }}회;;</h4>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>2-2. 우리들의 추억이 담긴 랜덤 메시지 50개(새로고침 시 변경)</h4>
        <p>
            {% for msg in data.msg_random %}
            "{{ msg }}"&nbsp;&nbsp;&nbsp;
            {% endfor %}
        </p>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>2-3. 가장 많이 보낸 메시지 top 10</h4>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>메시지</th>
                <th>횟수(많은 순)</th>
            </tr>
            {% for msg in data.msg_most_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ msg[0] }}</td>
                <td>{{ msg[1] }}회</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>2-4. 가장 적게 보낸 메시지 top 10</h4>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>메시지</th>
                <th>횟수(적은 순)</th>
            </tr>
            {% for msg in data.msg_least_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ msg[0] }}</td>
                <td>{{ msg[1] }}회</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>2-5. 가장 많이 보낸 단어</h4>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>2-6. 이 단어는 몇 번이나 나왔을까욘?</h4>
        <p id="kkt_search">
            <label>단어: </label>
            <input type="textarea" id="word">
            <button id="search">검색</button>
        </p>
        <p id="search_results"></p>
    </div>


    <h3>3. 누가 제일 많이 말하지?</h3>
    <p>
        일단 본인 {{ data.username }}은(는) 이 톡방에서 {{ data.talk_rank }}위고, {{ data.num_freq }}번 말했어욘ㅎ
        {% if data.talk_rank < 5 %}
        자주 오네요!
        {% elif data.talk_rank < 9 %}
        그래도 자리는 차지하는군요!
        {% else %}
        유령이시네요!
        {% endif %}
    </p>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>3-1. 카톡을 가장 많이 한 사람은...</h4>
        <p>당연하게도 {{ data.user_most }}입니당ㅋㅋ</p>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>3-2. 카톡을 가장 적게 한 사람은...</h4>
        <p>{{ data.user_least }}입니당ㅋㅋ</p>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>3-3. 전체 순위</h4>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>이름</th>
                <th>메시지 개수</th>
            </tr>
            {% for user in data.user_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ user[0] }}</td>
                <td>{{ user[1] }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>3-4. 일평균 발언량</h4>
        <p>
            일평균 발언량이란? 하루에 평균 몇 번 카톡 메시지를 보내는 지 계산한 값<br>
            {{ data.username }}은(는) {{ data.day_talk_rank }}위고, 하루 평균 {{ data.talk_avg }}번 말했음!
            {% if data.talk_avg > 100 %}
            독보적입니다!
            {% elif data.talk_avg > 30 %}
            많이 오네요ㅎ
            {% else %}
            우리를 버리셨나요?
            {% endif %}
        </p>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>이름</th>
                <th>일평균 메시지 개수</th>
            </tr>
            {% for value in data.day_talk_list %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ value.0 }}</td>
                <td>{{ value.1 }}개</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
        <h4>3-5. 언제 오세요?</h4>
        <p>마지막 카카오톡 날짜인 {{ data.last_day }}로부터 며칠 전에 마지막으로 왔을까요? 보고싶습니다 여러분...</p>
        <table data-aos="fade-up" data-aos-offset="50" data-aos-duration="1500">
            <tr>
                <th>순위</th>
                <th>이름</th>
                <th>마지막으로 온 날</th>
            </tr>
            {% for value in data.user_day_before %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ value.0 }}</td>
                <td>{{ value.1 }}일 전</td>
            </tr>
            {% endfor %}
        </table>
    </div>


    <h3>내년에도 함께해주세요 ♡</h3>


    <p>남은것:<br>
    시작날짜, 마지막날짜, 총 일수 - 구하긴 다 구했는데 sql 테이블로 만들지 않은 상태</p>
</section>

<script type="text/javascript">
    $("#search").click(function () {
        var data = $("#word").val();
        $.ajax({
            type: "GET",
            url: base_url + "/kakaotalk/search?word="+data,
            contentType: false, 
			processData: false, 
			cache: false,
            success: function (response) {
                // 여기.. 단어 display
                $('#search_results').empty();
                str = ''; 
                $.each(response , function(r, arr) {
                    str += '<b>총 ' + arr.length +'개의 메시지</b><br>';
                    $.each(arr, function (i, el) {
                        str += (el + '<br>');
                    });
                });
                $('#search_results').append(str);
            },
            error: function (request, status, error) {
                alert('단어를 입력하세요.');
            },
        });
    });
</script>
{% endblock %}